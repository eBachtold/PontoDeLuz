{% extends "base.html" %}

{% block content %}
<h3>Produtos</h3>

<div class="d-flex justify-content-between align-items-center mb-3">
    <a class="btn btn-primary" href="{{ url_for('novo_produto') }}">Novo Produto</a>
</div>

<form method="get" class="row g-2 mb-3">
    <div class="col-md-4">
        <label class="form-label">Filtrar por código</label>
        <input type="text"
               class="form-control"
               name="codigo"
               placeholder="Ex: COL-001"
               value="{{ filtro_codigo or '' }}">
    </div>

    <div class="col-md-4">
        <label class="form-label">Filtrar por categoria</label>
        <input type="text"
               class="form-control"
               name="categoria"
               placeholder="Ex: anel, brinco, colar"
               value="{{ filtro_categoria or '' }}">
    </div>

    <div class="col-md-4 d-flex align-items-end">
        <button type="submit" class="btn btn-success me-2">Filtrar</button>
        <a href="{{ url_for('produtos') }}" class="btn btn-outline-secondary">Limpar</a>
    </div>
</form>

<table class="table table-bordered table-striped">
    <tr>
        <th>ID</th>
        <th>Código</th>
        <th>Nome</th>
        <th>Categoria</th>
        <th>Custo</th>
        <th>Venda</th>
        <th>Estoque</th>
        <th style="width: 160px;">Ações</th>
    </tr>

    {% for p in produtos %}
    <tr>
        <td>{{ p.id }}</td>
        <td>{{ p.codigo }}</td>
        <td>{{ p.nome }}</td>
        <td>{{ p.categoria }}</td>
        <td>R$ {{ "%.2f"|format(p.preco_custo) }}</td>
        <td>R$ {{ "%.2f"|format(p.preco_venda) }}</td>
        <td>{{ p.estoque_atual }}</td>
        <td>
            <a href="{{ url_for('editar_produto', produto_id=p.id) }}"
               class="btn btn-sm btn-warning">Editar</a>

            <form action="{{ url_for('excluir_produto', produto_id=p.id) }}"
                  method="post"
                  style="display:inline;"
                  onsubmit="return confirm('Tem certeza que deseja excluir este produto?');">
                <button type="submit" class="btn btn-sm btn-danger">Excluir</button>
            </form>
        </td>
    </tr>
    {% endfor %}

    {% if not produtos %}
    <tr>
        <td colspan="8" class="text-center text-muted">
            Nenhum produto encontrado com os filtros atuais.
        </td>
    </tr>
    {% endif %}
</table>
{% endblock %}
